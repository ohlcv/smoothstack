# 交易记录页面 UI 设计文档（修订版）

## 功能描述

交易记录页面是系统的核心功能页面之一，展示来自所有策略的交易明细，提供全面的筛选、分析和导出功能，帮助用户跟踪所有策略的执行情况，分析交易模式和绩效，并优化整体交易策略组合。

## 页面结构

```
┌─────────────────────────────────────────────────────────────┐
│ 交易记录                                                    │
│ 查看和分析您的所有交易记录                                    │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────┐ │
│ │                   筛选与工具栏                          │ │
│ │                                                         │ │
│ │ [策略: 全部 ▼] [交易对: 全部 ▼] [开平: 全部 ▼] [方向: 全部 ▼] │
│ │                                                         │ │
│ │ 时间范围: [开始日期] 至 [结束日期]  [搜索框]   [导出CSV]  │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │                   交易统计卡片                          │ │
│ │                                                         │ │
│ │  总交易次数    总交易量     总盈亏    总盈亏率   胜率    │ │
│ │   1,258      $125,350    +$3,852   +15.4%    65.4%   │ │
│ │                                                         │ │
│ │  开仓次数      平仓次数    平均每笔盈亏   最大盈利   最大亏损 │ │
│ │    637         621         +$6.20     +$108.50   -$42.30 │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │                   交易记录表格                          │ │
│ │                                                         │ │
│ │ [□] 时间 | 策略名称 | 交易对 | 开平 | 方向 | 价格 | 数量 | 张数 | │
│ │ [□] 2023-05-20 15:30 | BTC网格 | BTC/USDT | 开仓 | 多 | $27,350 | 0.05 | 5 | │
│ │ [□] 2023-05-20 14:15 | ETH网格 | ETH/USDT | 平仓 | 多 | $1,850 | 0.5 | 1 | │
│ │ [□] 2023-05-20 12:40 | SOL网格 | SOL/USDT | 开仓 | 多 | $22.5 | 10 | 2 | │
│ │                                                         │ │
│ │                  [< 1 2 3 ... 42 >]                    │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │                   交易详情面板                          │ │
│ │                                                         │ │
│ │ 交易ID: trade-12345                  状态: 已完成       │ │
│ │                                                         │ │
│ │ 交易信息:                       订单详情:               │ │
│ │ 时间: 2023-05-20 15:30:45      订单ID: order-98765     │ │
│ │ 策略: BTC网格策略              订单类型: 限价单         │ │
│ │ 交易对: BTC/USDT               交易所: Binance         │ │
│ │ 开平: 开仓                     手续费: $0.15           │ │
│ │ 方向: 做多                     系统费: $0.23           │ │
│ │ 价格: $27,350                                          │ │
│ │ 数量: 0.05 BTC                                         │ │
│ │ 张数: 5张                                              │ │
│ │ 价值: $1,367.50                                        │ │
│ │ 备注: 网格层级2                                        │ │
│ │                                                         │ │
│ │ [查看相关策略] [查看交易所订单]                         │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 功能组件描述

### 1. 页面标题区
- 标题："交易记录"
- 副标题："查看和分析您的所有交易记录"
- 明确指示本页面展示系统内所有策略的交易记录

### 2. 筛选与工具栏
- 策略筛选：下拉菜单，包含所有已创建的策略，默认"全部"
- 交易对筛选：下拉菜单，包含系统支持的所有交易对，默认"全部"
- 开平筛选：开仓/平仓下拉菜单，默认"全部"
- 方向筛选：多/空下拉菜单，默认"全部"
- 时间范围选择：
  - 开始日期选择器
  - 结束日期选择器
  - 预设快捷选项（今天、昨天、7天、30天、90天）
- 搜索框：全文搜索交易记录（交易ID、订单ID等）
- 导出按钮：将符合筛选条件的数据导出为CSV格式

### 3. 交易统计卡片
- 根据当前筛选条件实时统计并展示关键指标：
  - 总交易次数：符合筛选条件的交易总量
  - 总交易量：所有交易的累计金额
  - 总盈亏：所有交易的盈亏总和（正值显示绿色，负值显示红色）
  - 总盈亏率：盈亏相对于交易总额的百分比
  - 胜率：盈利交易占总交易的百分比
  - 开仓次数和平仓次数
  - 平均每笔盈亏：平均单笔交易盈亏金额
  - 最大盈利和最大亏损：单笔交易的极值

### 4. 交易记录表格
- 表格列：
  - 复选框：支持批量选择
  - 时间：交易执行时间
  - 策略名称：执行交易的策略
  - 交易对：如BTC/USDT
  - 开平：开仓或平仓
  - 方向：做多或做空
  - 价格：成交价格
  - 数量：交易数量（如0.05 BTC）
  - 张数：合约张数
  - 价值：交易总价值（可选显示）
  - 盈亏：对于平仓交易显示盈亏金额（可选显示）
  - 状态：已完成、处理中、已取消等（可选显示）
- 表格功能：
  - 支持点击列标题排序
  - 支持调整列宽
  - 支持固定表头
  - 行点击选中展开详情
  - 支持调整显示列（个性化设置）
- 分页控件：位于表格底部，页码和翻页按钮

### 5. 交易详情面板
- 选中交易行时展开，显示完整交易信息：
  - 交易ID：系统内部唯一标识
  - 状态：交易状态（已完成、处理中等）
  - 交易信息：详细交易数据（时间、策略、交易对、开平、方向、价格、数量、张数、价值等）
  - 订单详情：交易所订单信息（订单ID、类型、交易所、手续费、系统费等）
  - 备注：附加信息，如网格层级
- 相关操作按钮：
  - 查看相关策略：跳转至相关策略详情页
  - 查看交易所订单：跳转至交易所原始订单（如可用）
- 面板展示方式：
  - 默认折叠
  - 点击表格行展开
  - 支持关闭按钮

## 交互说明

1. **筛选与搜索交互**
   - 下拉筛选器选择后自动应用筛选，多筛选条件组合使用（与逻辑）
   - 策略筛选支持多选，允许同时分析多个策略
   - 时间选择器支持日历选择和快捷选项
   - 搜索框支持实时搜索（输入时自动过滤）和高级搜索语法
   - 筛选条件变更自动更新统计卡片数据和表格内容
   - 筛选状态保存在URL中，便于分享和刷新

2. **表格交互**
   - 点击列标题排序（升序/降序切换）
   - 点击行选中展开详情面板
   - 鼠标悬停在行上高亮显示
   - 复选框支持多选（用于批量操作）
   - 右键单元格提供上下文菜单（复制、查看详情等）
   - 支持键盘导航（上下键、回车键）
   - 表格列宽可拖动调整
   - 可通过设置面板自定义显示列

3. **数据导出交互**
   - 点击导出按钮显示导出选项面板
   - 可选导出内容：当前页、所有筛选结果、选中行
   - 可选导出格式：CSV、Excel
   - 可选导出列：自定义选择要导出的数据列
   - 导出时显示进度指示器
   - 大数据量导出时提供后台任务选项（完成后通知）

4. **详情面板交互**
   - 点击行展开/折叠详情面板
   - 详情面板可选择固定显示或跟随滚动
   - 面板内链接点击打开新标签或模态框
   - 面板右上角提供关闭按钮
   - 查看相关策略按钮跳转至策略详情页相应标签

5. **批量操作交互**
   - 选中多行后显示批量操作工具栏
   - 批量操作选项：导出选中、添加标签、批量备注等
   - 批量操作前显示确认对话框
   - 操作完成后显示结果反馈

6. **响应式滚动与加载**
   - 表格支持虚拟滚动，高效处理大量数据
   - 滚动到底部时自动加载更多数据（无限滚动）
   - 加载状态提供明确的视觉反馈
   - 网络延迟或错误时提供重试机制

## 数据需求

1. **交易记录数据结构**
```json
{
  "trades": [
    {
      "id": "trade-12345",
      "timestamp": "2023-05-20T15:30:45Z",
      "strategy_id": "strategy-67890",
      "strategy_name": "BTC网格策略",
      "trading_pair": "BTC/USDT",
      "type": "open", // 开平: open-开仓, close-平仓
      "direction": "long", // 方向: long-做多, short-做空
      "price": 27350.00,
      "amount": 0.05,
      "contracts": 5, // 张数
      "value": 1367.50, // 价值
      "profit_loss": null, // 平仓才有盈亏
      "status": "completed",
      "order_id": "order-98765",
      "order_type": "limit",
      "fee": 0.15, // 交易所手续费
      "system_fee": 0.23, // 系统费用
      "exchange": "binance",
      "note": "网格层级2" // 备注
    },
    {
      "id": "trade-12346",
      "timestamp": "2023-05-20T14:15:20Z",
      "strategy_id": "strategy-67891",
      "strategy_name": "ETH网格策略",
      "trading_pair": "ETH/USDT",
      "type": "close",
      "direction": "long",
      "price": 1850.00,
      "amount": 0.5,
      "contracts": 1,
      "value": 925.00,
      "profit_loss": 25.30,
      "status": "completed",
      "order_id": "order-98766",
      "order_type": "limit",
      "fee": 0.09,
      "system_fee": 0.18,
      "exchange": "binance",
      "note": "网格层级3"
    }
  ],
  "pagination": {
    "current_page": 1,
    "total_pages": 42,
    "total_items": 1258,
    "items_per_page": 30
  },
  "statistics": {
    "total_trades": 1258,
    "total_volume": 125350.00,
    "total_profit_loss": 3852.00,
    "profit_loss_rate": 15.4,
    "win_rate": 65.4,
    "open_trades": 637,
    "close_trades": 621,
    "avg_profit_loss": 6.20,
    "max_profit": 108.50,
    "max_loss": -42.30
  }
}
```

2. **筛选条件数据结构**
```json
{
  "filters": {
    "strategies": ["all"], // 或具体策略ID数组
    "trading_pairs": ["all"], // 或具体交易对数组
    "types": ["all"], // 或 ["open", "close"]
    "directions": ["all"], // 或 ["long", "short"]
    "time_range": {
      "start": "2023-05-01T00:00:00Z",
      "end": "2023-05-31T23:59:59Z"
    },
    "search": "", // 搜索关键词
    "status": ["all"] // 或 ["completed", "processing", "cancelled"]
  },
  "sort": {
    "field": "timestamp",
    "order": "desc"
  }
}
```

## 状态管理

- **筛选状态**：
  - 所有筛选条件的当前值
  - 筛选条件变更历史（支持撤销/重做）
  - 自定义筛选组合的保存和加载

- **表格状态**：
  - 排序字段和方向
  - 选中行ID集合
  - 自定义列显示设置
  - 分页或滚动位置
  - 行展开/折叠状态

- **详情面板状态**：
  - 展开/折叠状态
  - 当前显示的交易ID
  - 面板固定/跟随模式

- **数据加载状态**：
  - 初始加载
  - 筛选中
  - 加载更多
  - 加载失败
  - 空数据提示

- **导出状态**：
  - 导出选项设置
  - 导出进度
  - 导出结果提示

## 响应式设计考虑

### 1. 桌面宽屏设备
- 完整表格布局，显示所有列
- 侧边详情面板，不遮挡表格
- 高级筛选选项完全展开
- 图表和统计数据完整展示

### 2. 平板设备
- 表格横向滚动，显示核心列
- 底部详情面板，覆盖部分表格
- 筛选条件组合到折叠面板
- 统计卡片改为网格布局

### 3. 移动设备
- 简化表格，仅显示核心数据列
- 详情查看使用全屏模态框
- 筛选条件使用抽屉式面板
- 统计数据使用卡片轮播
- 批量操作简化为核心功能

## 特殊考虑

### 1. 性能优化
- 大数据集渲染优化：
  - 虚拟滚动技术
  - 数据分批加载
  - 懒加载详情数据
- 筛选和排序性能：
  - 服务器端筛选排序
  - 客户端缓存策略
  - 增量更新机制

### 2. 用户体验优化
- 数据可视化增强：
  - 盈亏使用颜色编码（绿色盈利，红色亏损）
  - 交易量使用视觉比例标记
  - 特殊交易（如超大单）使用高亮显示
- 操作便捷性：
  - 常用筛选条件可保存为预设
  - 批量操作快捷方式
  - 键盘导航和快捷键支持
- 实时数据更新：
  - 新交易实时通知
  - 表格数据定时自动刷新
  - 刷新时保持用户视图状态

### 3. 集成功能
- 与策略详情集成：
  - 点击策略名称跳转至对应策略详情页
  - 从策略详情页可带筛选条件返回交易记录页
- 与分析工具集成：
  - 选中多笔交易后可创建自定义分析图表
  - 交易模式分析和识别功能
  - 交易绩效对比功能
- 导出和报告功能：
  - 生成交易报告（日报、周报、月报）
  - 定制化导出格式支持
  - 报表定时发送功能

### 4. 安全与合规
- 交易数据敏感信息保护
- 操作审计日志
- 数据导出权限控制
- 合规报告格式支持
